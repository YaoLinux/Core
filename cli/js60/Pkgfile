makedepends=(autoconf2-13 icu libffi nspr python2 zip)

packager="Yaolinux Team"
maintainer="sipo"

description="JS is Mozilla's JavaScript engine written in C."
url="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey"

name=js60
version=60.9.0

source=(https://archive.mozilla.org/pub/firefox/releases/${version}esr/source/firefox-${version}esr.source.tar.xz)

prepare(){

    mkdir mozjs-build
    cd    mozjs-build
}

build() {

   cd mozjs-build
   ../firefox-$version/js/src/configure --prefix=/usr       \
                       --with-intl-api     \
                       --with-system-zlib  \
                       --with-system-nspr  \
                       --with-system-icu   \
                       --disable-jemalloc  \
                       --enable-readline

  make

}


package() {

   cd mozjs-build
   make DESTDIR=$PKG install

  find "$PKG"/usr/{lib/pkgconfig,include} -type f -exec chmod -c a-x {} +
  # Already present on js52
  rm $PKG/usr/lib/libjs_static.ajs

}
