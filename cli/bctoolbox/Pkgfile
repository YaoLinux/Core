makedepends=(mbedtls bcunit cmake)

packager="Yaolinux Team"
maintainer="sipo"

description="A library written in C that allows you to create and run audio and video streams"
url="https://github.com/BelledonneCommunications/bctoolbox"

name=bctoolbox
version=0.6.0
release=2

source=(https://github.com/BelledonneCommunications/bctoolbox/archive/$version.tar.gz
        https://sources.debian.org/data/main/b/bctoolbox/0.6.0-2/debian/patches/fix-ftbfs-with-mbedtls-2.7.patch
        https://sources.debian.org/data/main/b/bctoolbox/0.6.0-2/debian/patches/deprecated_mbedtls_header)

prepare(){

  cd ${name}-$version
  patch -Np1 -i ../fix-ftbfs-with-mbedtls-2.7.patch
  patch -Np1 -i ../deprecated_mbedtls_header
  mkdir -pv build

}

build(){

  cd ${name}-$version/build
  cmake -DCMAKE_SKIP_RPATH=ON -DENABLE_TESTS_COMPONENT=OFF \
        -DENABLE_SHARED=ON -DCMAKE_INSTALL_PREFIX=/usr ..
  make
}

package() {

  cd ${name}-$version/build
  make DESTDIR="${PKG}" install

}
