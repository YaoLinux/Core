makedepends=(qtbase qtwebchannel qtlocation qttools poppler xorg-libxcomposite xorg-libxrandr pciutils libvpx libevent snappy nss protobuf libxslt ffmpeg git gperf json-cpp icu zlib libwebp xorg-libxscrnsaver)

description="Provides support for web applications using the Chromium browser project"
url="http://qt-project.org/"

packager="Yaolinux Team"
maintainer="rems"

name=qtwebengine
version=5.13.2
release=2

_name="${name}-everywhere-src"

source=(https://download.qt.io/official_releases/qt/${version:0:4}/$version/submodules/${_name}-${version}.tar.xz
        https://code.qt.io/cgit/qt/qtwebengine-chromium.git/patch/?id=d6e5fc10
        icu65.patch)

prepare() {

mv ?id=d6e5fc10 CVE-2019-13720.patch

cd ${_name}-$version/src/3rdparty
patch -p1 -i ../../../CVE-2019-13720.patch
patch -p1 -d chromium -i ../../../../icu65.patch
}

build() {

  mkdir build && cd build 

  qmake ../${_name}-${version} -- \
        -proprietary-codecs \
        -system-ffmpeg \
        -webp \
        -webengine-icu

  make
  make INSTALL_ROOT=$PKG install
}
