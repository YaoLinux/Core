makedepends=(xorg-libdrm libva wayland wayland-protocols)

description="VA-API implementation for Intel G45 and HD Graphics family"
url="https://01.org/linuxmedia/vaapi"

packager="Yaolinux Team"

name=libva-intel-driver
version=2.4.1
release=2

source=(https://github.com/intel/intel-vaapi-driver/releases/download/$version/intel-vaapi-driver-$version.tar.bz2
        427.patch)

prepare() {

  cd intel-vaapi-driver-$version

# https://github.com/intel/intel-vaapi-driver/issues/419
patch -Np1 -i ../427.patch
  
# Only relevant if intel-gpu-tools is installed,
# since then the shaders will be recompiled
sed -i '1s/python$/&2/' src/shaders/gpp.py

}

build () {

cd intel-vaapi-driver-$version

./configure --prefix=/usr \
            --enable-wayland

make
}

package() {

cd intel-vaapi-driver-$version
make DESTDIR="${PKG}" install
}
