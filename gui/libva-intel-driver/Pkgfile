# Depends on: xorg-libdrm libva meson wayland wayland-protocols

description="VA-API implementation for Intel G45 and HD Graphics family"
packager="YaoLinux Teams"
maintainer="Rems"
url="https://01.org/linuxmedia/vaapi"

name=libva-intel-driver
version=2.3.0

source=(https://github.com/intel/intel-vaapi-driver/releases/download/$version/intel-vaapi-driver-$version.tar.bz2
        427.patch)

prepare() {
  cd intel-vaapi-driver-$version
# https://github.com/intel/intel-vaapi-driver/issues/419
patch -Np1 -i ../427.patch
  
# Only relevant if intel-gpu-tools is installed,
# since then the shaders will be recompiled
sed -i '1s/python$/&2/' src/shaders/gpp.py

}

build () {

cd intel-vaapi-driver-$version

./configure --prefix=/usr --enable-wayland
make
}

package() {

cd intel-vaapi-driver-$version
make DESTDIR="${PKG}" install

# Obsolet lib
rm $PKG/usr/lib/dri/i965_drv_video.la
}
